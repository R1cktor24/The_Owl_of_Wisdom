<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–°–æ–≤–∞ –ú—É–¥—Ä–æ—Å—Ç—ñ ü¶â</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Inter:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #1a5c2e;
    --green-light: #2d8f4e;
    --felt: #1e6b38;
    --gold: #f0c040;
    --cream: #fdf6e3;
    --red: #c0392b;
    --dark: #0f2318;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; }
  body {
    background: radial-gradient(ellipse at center, var(--felt) 0%, var(--dark) 100%);
    min-height: 100vh;
    font-family: 'Inter', sans-serif;
    color: var(--cream);
    overflow-x: hidden;
  }
  .screen { display: none; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; gap: 14px; }
  .screen.active { display: flex; }
  .game-title {
    font-family: 'Unbounded', sans-serif;
    font-size: clamp(2rem, 7vw, 4rem);
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 4px 20px rgba(240,192,64,0.4);
    text-align: center;
    line-height: 1.1;
  }
  .subtitle { color: rgba(253,246,227,0.6); font-size: 0.85rem; }
  .card-input {
    background: rgba(255,255,255,0.05);
    border: 1.5px solid rgba(240,192,64,0.3);
    border-radius: 12px;
    padding: 14px 18px;
    color: var(--cream);
    font-size: 1rem;
    font-family: 'Inter', sans-serif;
    width: 100%;
    max-width: 340px;
    outline: none;
    transition: border-color 0.2s;
  }
  .card-input:focus { border-color: var(--gold); }
  .card-input::placeholder { color: rgba(253,246,227,0.3); }
  .btn {
    font-family: 'Unbounded', sans-serif;
    font-size: 0.8rem; font-weight: 700;
    letter-spacing: 1px; padding: 14px 24px;
    border-radius: 12px; border: none;
    cursor: pointer; transition: all 0.15s;
    width: 100%; max-width: 340px;
    text-transform: uppercase;
  }
  .btn:active { transform: scale(0.97); }
  .btn-gold { background: linear-gradient(135deg, var(--gold), #e0a820); color: var(--dark); box-shadow: 0 4px 20px rgba(240,192,64,0.3); }
  .btn-outline { background: transparent; color: var(--gold); border: 1.5px solid rgba(240,192,64,0.5); }
  .btn-outline:active { background: rgba(240,192,64,0.1); }
  .btn-red { background: linear-gradient(135deg, var(--red), #922b21); color: white; }
  .btn-green { background: linear-gradient(135deg, var(--green-light), #1a5c2e); color: white; }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
  .divider {
    display: flex; align-items: center; gap: 12px;
    width: 100%; max-width: 340px;
    color: rgba(253,246,227,0.3); font-size: 0.8rem;
  }
  .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: rgba(253,246,227,0.15); }
  /* SETUP */
  .setup-title { font-family: 'Unbounded', sans-serif; font-size: 1rem; font-weight: 700; color: var(--gold); text-align: center; }
  .images-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; max-width: 340px; }
  .img-slot {
    aspect-ratio: 2/3; border-radius: 8px;
    border: 2px dashed rgba(240,192,64,0.3);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    cursor: pointer; overflow: hidden; position: relative;
    background: rgba(255,255,255,0.03); transition: border-color 0.2s;
  }
  .img-slot:hover { border-color: var(--gold); }
  .img-slot img { width: 100%; height: 100%; object-fit: cover; }
  .img-slot .plus { font-size: 1.5rem; color: rgba(240,192,64,0.4); }
  .img-slot .num {
    position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%);
    font-size: 0.55rem; font-family: 'Unbounded', sans-serif;
    color: rgba(253,246,227,0.5); background: rgba(0,0,0,0.5);
    padding: 1px 4px; border-radius: 4px;
  }
  .img-slot.is-trump { border-color: var(--gold); border-style: solid; }
  .img-slot.is-trump::after {
    content: '‚≠ê–ö–û–ó–ò–†–¨';
    position: absolute; top: 2px; left: 50%; transform: translateX(-50%);
    font-size: 0.45rem; font-family: 'Unbounded', sans-serif;
    color: var(--gold); background: rgba(0,0,0,0.7);
    padding: 2px 4px; border-radius: 4px; white-space: nowrap;
  }
  .trump-hint { font-size: 0.75rem; color: rgba(253,246,227,0.5); text-align: center; max-width: 300px; }
  /* WAITING */
  .room-code {
    font-family: 'Unbounded', sans-serif;
    font-size: 3rem; font-weight: 900; color: var(--gold);
    letter-spacing: 10px; background: rgba(240,192,64,0.1);
    border: 2px dashed rgba(240,192,64,0.3); border-radius: 16px; padding: 20px 30px;
  }
  .pulse { animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
  /* GAME */
  #game-screen { padding: 0; min-height: 100vh; display: none; flex-direction: column; justify-content: space-between; }
  #game-screen.active { display: flex; }
  .player-area { padding: 10px 8px 6px; min-height: 120px; display: flex; flex-direction: column; gap: 6px; }
  .player-label { font-family: 'Unbounded', sans-serif; font-size: 0.6rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: rgba(253,246,227,0.5); padding: 0 4px; }
  .hand { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
  .table-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 8px; }
  .status-bar { font-family: 'Unbounded', sans-serif; font-size: 0.7rem; font-weight: 700; color: var(--gold); text-align: center; background: rgba(0,0,0,0.3); width: 100%; padding: 6px 10px; border-radius: 8px; }
  .field { display: flex; gap: 10px; align-items: center; justify-content: center; min-height: 100px; background: rgba(0,0,0,0.2); border-radius: 16px; width: 100%; max-width: 400px; padding: 12px; border: 1.5px solid rgba(255,255,255,0.07); position: relative; }
  .field-label { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--dark); color: rgba(253,246,227,0.3); font-size: 0.55rem; letter-spacing: 2px; padding: 2px 8px; border-radius: 20px; white-space: nowrap; }
  .action-btns { display: flex; gap: 8px; width: 100%; max-width: 400px; }
  .action-btns .btn { font-size: 0.65rem; padding: 10px 8px; }
  .trump-indicator { background: rgba(240,192,64,0.15); border: 1px solid rgba(240,192,64,0.4); border-radius: 10px; padding: 5px 10px; font-size: 0.65rem; color: var(--gold); font-weight: 600; display: flex; align-items: center; gap: 6px; }
  .trump-preview { width: 24px; height: 36px; border-radius: 4px; overflow: hidden; border: 1px solid var(--gold); background: #fff; position: relative; }
  .trump-preview img { position: absolute; top: 0; left: 0; height: 100%; width: 200%; }
  .card { width: 56px; height: 82px; border-radius: 8px; position: relative; cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; flex-shrink: 0; overflow: hidden; border: 2px solid rgba(255,255,255,0.15); background: #fff; user-select: none; }
  .card:active { transform: scale(0.95); }
  .card.selected { transform: translateY(-12px); box-shadow: 0 8px 25px rgba(240,192,64,0.6); border-color: var(--gold); }
  .card.disabled { cursor: not-allowed; opacity: 0.5; }
  .card.on-table { cursor: default; }
  .card img { position: absolute; top: 0; height: 100%; width: 200%; }
  .card.left img { left: 0; }
  .card.right img { left: -100%; }
  .card.trump-card::after { content: '‚≠ê'; position: absolute; top: 2px; right: 3px; font-size: 9px; }
  .card-back { width: 56px; height: 82px; border-radius: 8px; background: linear-gradient(135deg, #1a3a5c 0%, #0f2318 50%, #3a1a0f 100%); border: 2px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 1.3rem; flex-shrink: 0; }
  .count-badge { font-family: 'Unbounded', sans-serif; font-size: 0.55rem; font-weight: 700; color: rgba(253,246,227,0.5); text-align: center; }
  #result { gap: 20px; text-align: center; }
  .result-emoji { font-size: 5rem; }
  .result-title { font-family: 'Unbounded', sans-serif; font-size: 2rem; font-weight: 900; }
  .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(20,20,20,0.95); color: var(--cream); padding: 12px 24px; border-radius: 50px; font-size: 0.85rem; font-weight: 600; transition: transform 0.3s; z-index: 999; white-space: nowrap; border: 1px solid rgba(255,255,255,0.1); }
  .toast.show { transform: translateX(-50%) translateY(0); }
  input[type=file] { display: none; }
</style>
</head>
<body>

<!-- LOBBY -->
<div class="screen active" id="lobby">
  <div class="game-title">ü¶â –°–æ–≤–∞<br>–ú—É–¥—Ä–æ—Å—Ç—ñ</div>
  <div class="subtitle">–ö–∞—Ä—Ç–æ—á–Ω–∞ –≥—Ä–∞ –Ω–∞ –¥–≤–æ—Ö</div>
  <input class="card-input" id="nickname-input" placeholder="–¢–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º" maxlength="16" />
  <button class="btn btn-gold" onclick="goToSetup()">üéÆ –°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É</button>
  <div class="divider">–∞–±–æ</div>
  <input class="card-input" id="gameid-input" placeholder="–ö–æ–¥ –≥—Ä–∏ (6 –∑–Ω–∞–∫—ñ–≤)" maxlength="6" style="text-transform:uppercase" />
  <button class="btn btn-outline" onclick="joinGame()">üö™ –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è</button>
</div>

<!-- SETUP -->
<div class="screen" id="setup">
  <div class="game-title" style="font-size:1.8rem">ü¶â –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</div>
  <div class="setup-title">–ó–∞–≤–∞–Ω—Ç–∞–∂ 5 –∫–∞—Ä—Ç–∏–Ω–æ–∫</div>
  <div class="trump-hint">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ —Å–ª–æ—Ç ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ.<br>–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–µ —Ñ–æ—Ç–æ ‚Äî –∑—Ä–æ–±–∏—Ç–∏ –∫–æ–∑–∏—Ä–µ–º ‚≠ê</div>
  <div class="images-grid" id="images-grid">
    <div class="img-slot" id="slot-0" onclick="handleSlotClick(0)"><span class="plus">+</span><span class="num">1</span></div>
    <div class="img-slot" id="slot-1" onclick="handleSlotClick(1)"><span class="plus">+</span><span class="num">2</span></div>
    <div class="img-slot" id="slot-2" onclick="handleSlotClick(2)"><span class="plus">+</span><span class="num">3</span></div>
    <div class="img-slot" id="slot-3" onclick="handleSlotClick(3)"><span class="plus">+</span><span class="num">4</span></div>
    <div class="img-slot" id="slot-4" onclick="handleSlotClick(4)"><span class="plus">+</span><span class="num">5</span></div>
  </div>
  <input type="file" id="file-input" accept="image/*" onchange="onFileSelected()" />
  <div style="color:rgba(253,246,227,0.5);font-size:0.75rem;text-align:center">
    –ö–æ–∑–∏—Ä: <span id="trump-name" style="color:var(--gold)">–Ω–µ –≤–∏–±—Ä–∞–Ω–æ</span>
  </div>
  <button class="btn btn-gold" id="btn-create" onclick="createGame()" disabled>üöÄ –°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É</button>
  <button class="btn btn-outline" onclick="showScreen('lobby')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- WAITING -->
<div class="screen" id="waiting">
  <div class="game-title" style="font-size:1.8rem">ü¶â –û—á—ñ–∫—É–≤–∞–Ω–Ω—è...</div>
  <div style="color:rgba(253,246,227,0.6)">–ö–æ–¥ –≤–∞—à–æ—ó –≥—Ä–∏:</div>
  <div class="room-code pulse" id="display-game-id">------</div>
  <div style="color:rgba(253,246,227,0.5);font-size:0.85rem;text-align:center">–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –∫–æ–¥–æ–º –∑ –¥—Ä—É–≥–∏–º –≥—Ä–∞–≤—Ü–µ–º</div>
  <button class="btn btn-outline" style="max-width:200px" onclick="copyCode()">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–¥</button>
</div>

<!-- GAME -->
<div class="screen" id="game-screen">
  <div class="player-area" style="background:rgba(0,0,0,0.2)">
    <div class="player-label" id="opponent-label">–°—É–ø–µ—Ä–Ω–∏–∫</div>
    <div class="hand" id="opponent-hand"></div>
    <div class="count-badge" id="opponent-count"></div>
  </div>
  <div class="table-area">
    <div class="status-bar" id="status-bar">...</div>
    <div class="trump-indicator">
      <div class="trump-preview"><img id="trump-img-preview" src="" /></div>
      <span>–ö–û–ó–ò–† ‚≠ê</span>
    </div>
    <div class="field" id="field">
      <div class="field-label">–°–¢–Ü–õ</div>
      <div id="field-cards" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center"></div>
    </div>
    <div class="action-btns" id="action-btns" style="display:none">
      <button class="btn btn-green" id="btn-defend" onclick="defendCard()" style="display:none">‚úÖ –í—ñ–¥–±–∏—Ç–∏</button>
      <button class="btn btn-red" id="btn-take" onclick="takeCards()" style="display:none">‚òùÔ∏è –í–∑—è—Ç–∏</button>
      <button class="btn btn-gold" id="btn-attack" onclick="attackCard()" style="display:none">‚öîÔ∏è –•–æ–¥–∏—Ç–∏</button>
    </div>
  </div>
  <div class="player-area">
    <div class="count-badge" id="my-count"></div>
    <div class="hand" id="my-hand"></div>
    <div class="player-label" id="my-label">–í–∏</div>
  </div>
</div>

<!-- RESULT -->
<div class="screen" id="result">
  <div class="result-emoji" id="result-emoji">üèÜ</div>
  <div class="result-title" id="result-title">–í–∏ –≤–∏–≥—Ä–∞–ª–∏!</div>
  <div id="result-sub" style="color:rgba(253,246,227,0.6);margin:10px 0"></div>
  <button class="btn btn-gold" onclick="location.reload()">üîÑ –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
</div>

<div class="toast" id="toast"></div>

<script>
const SERVER_URL = 'wss://tranquil-houston-aforethought.ngrok-free.dev';

let ws = null;
let myRole = null;
let myHand = [];
let opponentHandCount = 0;
let phase = 'idle';
let selectedCard = null;
let trumpImg = -1;
let myNick = '';
let opNick = '';
let fieldCard = null;
let CARD_IMAGES = ['', '', '', '', ''];
let loadedCount = 0;
let currentSlot = -1;
let slotLoaded = [false, false, false, false, false];

function goToSetup() {
  myNick = document.getElementById('nickname-input').value.trim() || '–ì—Ä–∞–≤–µ—Ü—å 1';
  showScreen('setup');
}

function handleSlotClick(idx) {
  if (slotLoaded[idx]) {
    setTrump(idx);
  } else {
    currentSlot = idx;
    document.getElementById('file-input').click();
  }
}

function onFileSelected() {
  const file = document.getElementById('file-input').files[0];
  if (!file || currentSlot === -1) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    const ci = currentSlot;
    CARD_IMAGES[ci] = e.target.result;
    slotLoaded[ci] = true;
    loadedCount = slotLoaded.filter(Boolean).length;
    const slot = document.getElementById('slot-' + ci);
    slot.innerHTML = `<img src="${e.target.result}" /><span class="num">${ci+1}</span>`;
    slot.onclick = () => handleSlotClick(ci);
    if (trumpImg === -1 && loadedCount === 1) setTrump(ci);
    checkSetupReady();
    document.getElementById('file-input').value = '';
    currentSlot = -1;
  };
  reader.readAsDataURL(file);
}

function setTrump(idx) {
  trumpImg = idx;
  document.querySelectorAll('.img-slot').forEach((s, i) => s.classList.toggle('is-trump', i === idx));
  document.getElementById('trump-name').textContent = `–ö–∞—Ä—Ç–∏–Ω–∫–∞ ${idx+1} ‚≠ê`;
}

function checkSetupReady() {
  const allLoaded = slotLoaded.every(Boolean);
  document.getElementById('btn-create').disabled = !(allLoaded && trumpImg !== -1);
}

function connect(cb) {
  ws = new WebSocket(SERVER_URL);
  ws.onopen = cb;
  ws.onmessage = (e) => handleMessage(JSON.parse(e.data));
  ws.onerror = () => showToast('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è!');
  ws.onclose = () => {
    if (document.getElementById('game-screen').classList.contains('active')) {
      showScreen('result');
      document.getElementById('result-emoji').textContent = 'üíî';
      document.getElementById('result-title').textContent = '–ì—Ä–∞–≤–µ—Ü—å –≤—ñ–¥–∫–ª—é—á–∏–≤—Å—è';
    }
  };
}

function sendWS(data) {
  if (ws && ws.readyState === WebSocket.OPEN) ws.send(JSON.stringify(data));
}

function createGame() {
  connect(() => sendWS({ type: 'create-game', nickname: myNick, images: CARD_IMAGES, trumpImg }));
}

function joinGame() {
  myNick = document.getElementById('nickname-input').value.trim() || '–ì—Ä–∞–≤–µ—Ü—å 2';
  const gameId = document.getElementById('gameid-input').value.trim().toUpperCase();
  if (!gameId) { showToast('–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –≥—Ä–∏!'); return; }
  connect(() => sendWS({ type: 'join-game', gameId, nickname: myNick }));
}

function copyCode() {
  navigator.clipboard.writeText(document.getElementById('display-game-id').textContent).then(() => showToast('üìã –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'));
}

function selectCard(idx) {
  if (phase === 'idle' || phase === 'wait') return;
  selectedCard = selectedCard === idx ? null : idx;
  renderHand();
  updateActionBtns();
}

function attackCard() {
  if (selectedCard === null || phase !== 'attack') return;
  const card = myHand[selectedCard];
  if (myHand.length === 1 && card.img === trumpImg) { showToast('‚ùå –ö–æ–∑–∏—Ä–µ–º –Ω–µ –º–æ–∂–Ω–∞ —Ö–æ–¥–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—å–æ—é –∫–∞—Ä—Ç–æ—é!'); return; }
  sendWS({ type: 'attack', card });
}

function defendCard() {
  if (selectedCard === null || phase !== 'defend') return;
  const card = myHand[selectedCard];
  if (myHand.length === 1 && card.img === trumpImg) { showToast('‚ùå –ö–æ–∑–∏—Ä–µ–º –Ω–µ –º–æ–∂–Ω–∞ –≤—ñ–¥–±–∏–≤–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—å–æ—é –∫–∞—Ä—Ç–æ—é!'); return; }
  sendWS({ type: 'defend', card });
}

function takeCards() {
  if (phase !== 'defend') return;
  selectedCard = null;
  sendWS({ type: 'take-cards' });
}

function handleMessage(data) {
  switch(data.type) {
    case 'game-created':
      document.getElementById('display-game-id').textContent = data.gameId;
      showScreen('waiting');
      break;
    case 'player-joined':
      opNick = data.guestNick;
      showToast(`${opNick} –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è!`);
      setTimeout(() => sendWS({ type: 'start-game' }), 800);
      break;
    case 'joined':
      opNick = data.hostNick;
      CARD_IMAGES = data.images;
      trumpImg = data.trumpImg;
      showToast(`–ü—Ä–∏—î–¥–Ω–∞–≤—Å—è –¥–æ –≥—Ä–∏ ${opNick}!`);
      break;
    case 'game-start':
      myRole = data.role;
      trumpImg = data.trumpImg;
      CARD_IMAGES = data.images;
      myHand = data.hand;
      opponentHandCount = 5;
      fieldCard = null;
      phase = data.attacker === myRole ? 'attack' : 'wait';
      document.getElementById('my-label').textContent = myNick + ' (–í–∏)';
      document.getElementById('opponent-label').textContent = opNick;
      setupTrumpPreview();
      renderHand(); renderOpponentHand(); updateUI();
      showScreen('game-screen');
      break;
    case 'attack-sent':
      myHand = data.hand; fieldCard = data.card;
      renderHand(); renderField(); phase = 'wait'; updateUI();
      break;
    case 'incoming-attack':
      fieldCard = data.card; renderField();
      phase = 'defend'; opponentHandCount--;
      renderOpponentHand(); updateUI();
      break;
    case 'defend-success':
      myHand = data.hand; fieldCard = null;
      phase = data.attacker === myRole ? 'attack' : 'wait';
      selectedCard = null;
      renderHand(); renderField(); updateUI();
      if (phase === 'attack') showToast('‚úÖ –í—ñ–¥–±–∏—Ç–æ! –í–∞—à —Ö—ñ–¥');
      break;
    case 'took-cards':
      myHand = data.hand; fieldCard = null; phase = 'wait'; selectedCard = null;
      renderHand(); renderField(); updateUI();
      showToast('–í–∏ –≤–∑—è–ª–∏ –∫–∞—Ä—Ç–∏');
      break;
    case 'opponent-took':
      opponentHandCount += fieldCard ? 1 : 0;
      fieldCard = null; phase = 'attack'; selectedCard = null;
      renderField(); renderOpponentHand(); updateUI();
      showToast('–°—É–ø–µ—Ä–Ω–∏–∫ –≤–∑—è–≤ –∫–∞—Ä—Ç–∏! –í–∞—à —Ö—ñ–¥');
      break;
    case 'invalid-defend':
      showToast('‚ùå –¢–∞–∫ –Ω–µ –º–æ–∂–Ω–∞ –≤—ñ–¥–±–∏—Ç–∏!'); break;
    case 'error':
      showToast('‚ùå ' + data.message); break;
    case 'game-over':
      showScreen('result');
      const iWon = data.winner === myRole;
      document.getElementById('result-emoji').textContent = iWon ? 'üèÜ' : 'üòÖ';
      document.getElementById('result-title').textContent = iWon ? '–í–∏ –≤–∏–≥—Ä–∞–ª–∏!' : '–í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏!';
      document.getElementById('result-sub').textContent = `${data.winnerNick} —Å–∫–∏–Ω—É–≤ —É—Å—ñ –∫–∞—Ä—Ç–∏`;
      break;
    case 'opponent-left':
      showScreen('result');
      document.getElementById('result-emoji').textContent = 'üèÉ';
      document.getElementById('result-title').textContent = '–°—É–ø–µ—Ä–Ω–∏–∫ –≤—Ç—ñ–∫!';
      document.getElementById('result-sub').textContent = '–í–∏ –ø–µ—Ä–µ–º–æ–≥–ª–∏ üòÑ';
      break;
  }
}

function setupTrumpPreview() {
  document.getElementById('trump-img-preview').src = CARD_IMAGES[trumpImg];
}

function renderHand() {
  const container = document.getElementById('my-hand');
  container.innerHTML = '';
  const isMyTurn = phase === 'attack' || phase === 'defend';
  myHand.forEach((card, idx) => {
    const div = document.createElement('div');
    div.className = 'card ' + (card.half === 0 ? 'left' : 'right');
    if (card.img === trumpImg) div.className += ' trump-card';
    if (selectedCard === idx) div.className += ' selected';
    if (!isMyTurn) div.className += ' disabled';
    const img = document.createElement('img');
    img.src = CARD_IMAGES[card.img];
    div.appendChild(img);
    div.onclick = () => selectCard(idx);
    container.appendChild(div);
  });
  document.getElementById('my-count').textContent = `${myHand.length} –∫–∞—Ä—Ç`;
}

function renderOpponentHand() {
  const container = document.getElementById('opponent-hand');
  container.innerHTML = '';
  for (let i = 0; i < opponentHandCount; i++) {
    const div = document.createElement('div');
    div.className = 'card-back';
    div.textContent = 'ü¶â';
    container.appendChild(div);
  }
  document.getElementById('opponent-count').textContent = `${opponentHandCount} –∫–∞—Ä—Ç`;
}

function renderField() {
  const container = document.getElementById('field-cards');
  container.innerHTML = '';
  if (!fieldCard) return;
  const div = document.createElement('div');
  div.className = 'card on-table ' + (fieldCard.half === 0 ? 'left' : 'right');
  if (fieldCard.img === trumpImg) div.className += ' trump-card';
  const img = document.createElement('img');
  img.src = CARD_IMAGES[fieldCard.img];
  div.appendChild(img);
  container.appendChild(div);
}

function updateUI() {
  const status = document.getElementById('status-bar');
  const btns = document.getElementById('action-btns');
  switch(phase) {
    case 'attack':
      status.textContent = '‚öîÔ∏è –í–∞—à —Ö—ñ–¥ ‚Äî –æ–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç—É —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–•–æ–¥–∏—Ç–∏"';
      btns.style.display = 'flex';
      document.getElementById('btn-attack').style.display = 'block';
      document.getElementById('btn-defend').style.display = 'none';
      document.getElementById('btn-take').style.display = 'none';
      break;
    case 'defend':
      status.textContent = 'üõ°Ô∏è –í—ñ–¥–±–∏–π—Ç–µ –∫–∞—Ä—Ç—É –∞–±–æ –≤—ñ–∑—å–º—ñ—Ç—å —Å–æ–±—ñ';
      btns.style.display = 'flex';
      document.getElementById('btn-defend').style.display = 'block';
      document.getElementById('btn-take').style.display = 'block';
      document.getElementById('btn-attack').style.display = 'none';
      break;
    case 'wait':
      status.textContent = '‚è≥ –•—ñ–¥ —Å—É–ø–µ—Ä–Ω–∏–∫–∞...';
      btns.style.display = 'none';
      break;
    default:
      status.textContent = '...';
      btns.style.display = 'none';
  }
  updateActionBtns();
}

function updateActionBtns() {
  document.getElementById('btn-attack').disabled = selectedCard === null;
  document.getElementById('btn-defend').disabled = selectedCard === null;
  document.getElementById('btn-attack').style.opacity = selectedCard === null ? '0.5' : '1';
  document.getElementById('btn-defend').style.opacity = selectedCard === null ? '0.5' : '1';
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

let toastTimer = null;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2800);
}
</script>
</body>
</html>
